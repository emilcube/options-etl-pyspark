# options-etl-pyspark
Исходные данные:
файлы с трейдами опционов с некоторой биржи по дням (в каждом файле трейды одного опциона за некоторый день)

Задачи:
1) Произвести расчет характеристик опционов: iv (implied volatility), rtv (root time vega)
2) Исходные файлы содержали суточную информацию по каждому опциону, необходимо сформировать посуточные файлы по всем опционам и произвести расчёт 1)
3) Сформировать файл с суммами часовых rtv по всем опционам и расчитать EMA (Exponential Moving Average - экспоненциальная скользящая средняя)

Расчетная формула rtv:
rtv  = vega * trade_amount / sqrt(time_to_maturity)


Расчетная формула EMA:
EMA_0 = sum(rtv_0)

EMA_t = (1 - alpha) * EMA_(t-1) + alpha * sum(rtv_t)

=====================================

Решение задачи преобразования файлов опционов:
Для расчёта характеристик был необходим файл с минутными ценами спота (BTC-USDT), данный файл был сформирован: использовался API биржи (REST-запросы). В качестве расчётов использовалась минутная "свеча" открытия

В качестве расчётной библиотеки для 1) использовался py_vollib (с некоторыми модификациями: util.py)

Пример сформированного файла с минутными ценами BTC-USDT.




![image](https://github.com/emilcube/options-etl-pyspark/assets/24300598/dd9307ad-649a-4f30-b549-ccff42e081ab)



Пример части исходного файла (трейды BTC-12MAY23-29000-С за 12 мая 2023)
![image](https://github.com/emilcube/options-etl-pyspark/assets/24300598/f48c65bf-08c5-450e-9014-d8431da4c709)

Расчёт вспомогательных характеристик (например DiffInSeconds - время в годах до экспирации опциона), и главных характеристик в рамках задачи 1): iv, rtv
![image](https://github.com/emilcube/options-etl-pyspark/assets/24300598/bf007313-092a-4354-99af-fc375b546f2b)


Расчёт суммарного почасового rtv по всем опционам



![image](https://github.com/emilcube/options-etl-pyspark/assets/24300598/cfc3f471-781b-47b9-9e41-492df19b6e02)


Расчёт EMA (экспоненциальная скользящая средняя)



![image](https://github.com/emilcube/options-etl-pyspark/assets/24300598/820d1f13-c419-490b-81b9-a20fb047b545)


